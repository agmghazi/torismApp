{"version":3,"sources":["./node_modules/@arcgis/core/geometry/support/normalizeUtilsSync.js","./node_modules/@arcgis/core/views/interactive/snapping/featureSources/GraphicsSnappingSource.js","./node_modules/@arcgis/core/views/interactive/snapping/hints/PointSnappingHint.js"],"names":[],"mappings":"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","file":"featureSources-GraphicsSnappingSource-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{create as n}from\"./aaBoundingRect.js\";import{getBoundsXY as t}from\"./boundsUtils.js\";import{extentIntersectsPolyline as i}from\"./intersectsBase.js\";import{isPoint as m,isMultipoint as s,isExtent as e,isPolygon as x,isPolyline as o}from\"./jsonUtils.js\";import{cutParams as a,getGeometryParts as r,offsetMagnitude as f}from\"./normalizeUtilsCommon.js\";import{getInfo as c,isWebMercator as l}from\"./spatialReferenceUtils.js\";function u(n){if(!n)return null;let r=null;const u=n.spatialReference,d=c(u);if(!d)return\"toJSON\"in n?n.toJSON():n;const I=l(u)?102100:4326,g=a[I].maxX,j=a[I].minX,M=a[I].plus180Line,N=a[I].minus180Line;let O;const S=\"toJSON\"in n?n.toJSON():n;if(m(S))O=h(S,g,j);else if(s(S))S.points=S.points.map((n=>h(n,g,j))),O=S;else if(e(S))O=y(S,d);else if(x(S)||o(S)){const n=J;t(n,S);const m={xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3]},s=f(m.xmin,j)*(2*g),e=0===s?S:p(S,s);m.xmin+=s,m.xmax+=s,i(m,M)&&m.xmax!==g||i(m,N)&&m.xmin!==j?r=e:O=e}else O=S;if(null!==r){return(new v).cut(r,g)}return O}function p(n,t){const i=r(n);for(const m of i)for(const n of m)n[0]+=t;return n}function y(n,t){if(!t)return n;const i=d(n,t).map((n=>n.extent));return i.length<2?i[0]||n:i.length>2?(n.xmin=t.valid[0],n.xmax=t.valid[1],n):{rings:i.map((n=>[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]))}}function h(n,t,i){if(Array.isArray(n)){const m=n[0];if(m>t){const i=f(m,t);n[0]=m+i*(-2*t)}else if(m<i){const t=f(m,i);n[0]=m+t*(-2*i)}}else{const m=n.x;if(m>t){const i=f(m,t);n.x+=i*(-2*t)}else if(m<i){const t=f(m,i);n.x+=t*(-2*i)}}return n}function d(n,t){const i=[],{ymin:m,ymax:s}=n,e=n.xmax-n.xmin,x=n.xmin,o=n.xmax;let a;const[r,f]=t.valid;a=I(n.xmin,t);const c=a.x,l=a.frameId;a=I(n.xmax,t);const u=a.x,p=a.frameId,y=c===u&&e>0;if(e>2*f){const n={xmin:x<o?c:u,ymin:m,xmax:f,ymax:s},t={xmin:r,ymin:m,xmax:x<o?u:c,ymax:s},e={xmin:0,ymin:m,xmax:f,ymax:s},a={xmin:r,ymin:m,xmax:0,ymax:s},y=[],h=[];g(n,e)&&y.push(l),g(n,a)&&h.push(l),g(t,e)&&y.push(p),g(t,a)&&h.push(p);for(let i=l+1;i<p;i++)y.push(i),h.push(i);i.push({extent:n,frameIds:[l]},{extent:t,frameIds:[p]},{extent:e,frameIds:y},{extent:a,frameIds:h})}else c>u||y?i.push({extent:{xmin:c,ymin:m,xmax:f,ymax:s},frameIds:[l]},{extent:{xmin:r,ymin:m,xmax:u,ymax:s},frameIds:[p]}):i.push({extent:{xmin:c,ymin:m,xmax:u,ymax:s},frameIds:[l]});return i}function I(n,t){const[i,m]=t.valid,s=2*m;let e,x=0;return n>m?(e=Math.ceil(Math.abs(n-m)/s),n-=e*s,x=e):n<i&&(e=Math.ceil(Math.abs(n-i)/s),n+=e*s,x=-e),{x:n,frameId:x}}function g(n,t){const{xmin:i,ymin:m,xmax:s,ymax:e}=t;return j(n,i,m)&&j(n,i,e)&&j(n,s,e)&&j(n,s,m)}function j(n,t,i){return t>=n.xmin&&t<=n.xmax&&i>=n.ymin&&i<=n.ymax}class v{cut(n,t){let i;if(n.rings)this.closed=!0,i=n.rings,this.minPts=4;else{if(!n.paths)return null;this.closed=!1,i=n.paths,this.minPts=2}const m=i.length,s=-2*t;for(let e=0;e<m;e++){const n=i[e];if(n&&n.length>=this.minPts){const t=[];for(const i of n)t.push([i[0]+s,i[1]]);i.push(t)}}return this.closed?n.rings=i:n.paths=i,n}}const J=n();export{u as normalizeCentralMeridianSync};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{removeUnordered as r}from\"../../../../core/arrayUtils.js\";import{HandleOwnerMixin as s}from\"../../../../core/HandleOwner.js\";import{isSome as o,isNone as i}from\"../../../../core/maybe.js\";import{eachAlwaysValues as a,createTask as n}from\"../../../../core/promiseUtils.js\";import{property as p}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as d}from\"../../../../core/accessorSupport/decorators/subclass.js\";import c from\"../../../../geometry/Polygon.js\";import{canProjectWithoutEngine as l,project as u,initializeProjection as h}from\"../../../../geometry/projection.js\";import{normalizeCentralMeridianSync as m}from\"../../../../geometry/support/normalizeUtilsSync.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../../geometry/support/typeUtils.js\";import{convertFromGeometry as f}from\"../../../../layers/graphics/featureConversionUtils.js\";import g from\"../../../../layers/graphics/OptimizedFeature.js\";import S from\"../../../../layers/graphics/data/FeatureStore.js\";import j from\"../../../../layers/graphics/data/QueryEngine.js\";import{sortCandidatesInPlace as w}from\"../snappingUtils.js\";import{convertSnappingCandidate as v}from\"./queryEngineUtils.js\";let k=class extends(s(t)){constructor(e){super(e),this.availability=1,this.sources={multipoint:null,point:null,polygon:null,polyline:null},this.loadedWkids=new Set,this.loadedWkts=new Set,this.pendingAdds=[]}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){const e=this.pendingAdds;this.pendingAdds.length=0;for(const t of e)t.task.abort();this.mapSources((e=>this.destroySource(e)))}initialize(){this.handles.add([this.layer.on(\"graphic-update\",(e=>this.onGraphicUpdate(e))),this.updatingHandles.addOnCollectionChange(this.layer.graphics,(e=>this.onGraphicsChanged(e)))]),this.addMany(this.layer.graphics.toArray())}async fetchCandidates(e,t){const r=await a(this.mapSources((r=>r.queryEngine.executeQueryForSnapping({point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),distance:e.distance,types:e.types,query:o(e.filter)?e.filter.createQuery().toJSON():{where:\"1=1\"}},t).then((({candidates:e})=>e))))),s=r.flat().map((t=>v(t,e.coordinateHelper)));return w(e.point,s),s}refresh(){}onGraphicUpdate(e){switch(e.property){case\"geometry\":case\"visible\":this.remove(e.graphic),this.addMany([e.graphic])}}onGraphicsChanged(e){for(const t of e.removed)this.remove(t);this.addMany(e.added)}addMany(e){const t=[],r=new Map;for(const s of e)i(s.geometry)||(this.needsInitializeProjection(s.geometry.spatialReference)?(t.push(s.geometry.spatialReference),r.set(s.uid,s)):this.add(s));this.createPendingAdd(t,r)}createPendingAdd(e,t){if(!e.length)return;const s=n((async r=>{await h(e.map((e=>({source:e,dest:this.spatialReference}))),{signal:r}),this.markLoadedSpatialReferences(e);for(const[,e]of t)this.add(e)}));this.updatingHandles.addPromise(s.promise);const o={task:s,graphics:t},i=()=>r(this.pendingAdds,o);s.promise.then(i,i),this.pendingAdds.push(o)}markLoadedSpatialReferences(e){for(const t of e)null!=t.wkid&&this.loadedWkids.add(t.wkid),null!=t.wkt&&this.loadedWkts.add(t.wkt)}add(e){if(i(e.geometry)||!e.visible)return;let t=e.geometry;if(\"mesh\"===t.type)return;\"extent\"===t.type&&(t=c.fromExtent(t));const r=this.ensureSource(t.type);if(i(r))return;const s=this.createOptimizedFeature(e.uid,t);o(s)&&r.featureStore.add(s)}needsInitializeProjection(e){return(null==e.wkid||!this.loadedWkids.has(e.wkid))&&((null==e.wkt||!this.loadedWkts.has(e.wkt))&&!l(e,this.spatialReference))}createOptimizedFeature(e,t){const r=u(m(t),this.spatialReference);return r?new g(f(r,!1,!1),{[O]:e},null,e):null}ensureSource(e){const t=this.sources[e];if(o(t))return t;const r=this.createSource(e);return this.sources[e]=r,r}createSource(e){const t=y.toJSON(e),r=new S({geometryType:t,hasZ:!1,hasM:!1});return{featureStore:r,queryEngine:new j({featureStore:r,fields:[{name:O,type:\"esriFieldTypeOID\",alias:O}],geometryType:t,hasM:!1,hasZ:!1,objectIdField:O,spatialReference:this.spatialReference,scheduler:o(this.view)&&\"3d\"===this.view.type?this.view.resourceController.scheduler:null}),type:e}}remove(e){this.mapSources((t=>this.removeFromSource(t,e)));for(const t of this.pendingAdds)t.graphics.delete(e.uid),0===t.graphics.size&&t.task.abort()}removeFromSource(e,t){const r=t.uid;e.featureStore.has(r)&&e.featureStore.removeById(t.uid)}destroySource(e){e.queryEngine.destroy(),this.sources[e.type]=null}mapSources(e){const{point:t,polygon:r,polyline:s,multipoint:i}=this.sources,a=[];return o(t)&&a.push(e(t)),o(r)&&a.push(e(r)),o(s)&&a.push(e(s)),o(i)&&a.push(e(i)),a}};e([p({constructOnly:!0})],k.prototype,\"spatialReference\",void 0),e([p({constructOnly:!0})],k.prototype,\"layerSource\",void 0),e([p({constructOnly:!0})],k.prototype,\"view\",void 0),e([p({readOnly:!0})],k.prototype,\"updating\",null),e([p({readOnly:!0})],k.prototype,\"availability\",void 0),k=e([d(\"esri.views.interactive.snapping.featureSources.GraphicsSnappingSource\")],k);const O=\"OBJECTID\";export{k as GraphicsSnappingSource};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{objectEqual as t}from\"../snappingUtils.js\";import{SnappingHint as n}from\"./SnappingHint.js\";class s extends n{constructor(t){super(),this.point=t}equals(n){return n instanceof s&&t(this.point,n.point)}}export{s as PointSnappingHint};\n"],"sourceRoot":"webpack:///"}