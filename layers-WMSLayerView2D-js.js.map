{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/layers/WMSLayerView2D.js","./node_modules/@arcgis/core/views/layers/WMSLayerView.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC00B,QAAQ,uDAAC,kDAAkD,oBAAoB,6EAAC,CAAC,6FAAC,CAAC,yEAAC,CAAC,6DAAC,KAAK,aAAa,MAAM,eAAe,MAAM,4FAA4F,sDAAC,0JAA0J,QAAQ,IAAI,UAAU,mCAAmC,0EAAC,gBAAgB,GAAG,SAAS,MAAM,QAAQ,OAAO,iCAAiC,GAAG,0BAA0B,2EAAC,kEAAkE,mEAAC,EAAE,sNAAsN,qGAAqG,SAAS,8JAA8J,aAAa,cAAc,UAAU,qBAAqB,iCAAiC,MAAM,OAAO,+BAA+B,QAAQ,IAAI,mBAAmB,GAAG,mBAAmB,wBAAwB,MAAM,sCAAsC,mBAAmB,sCAAsC,2DAAC,EAAE,+CAA+C,cAAc,kBAAkB,wEAAwE,OAAO,mCAAmC,kBAAkB,qBAAqB,aAAa,oDAAoD,oBAAoB,oCAAoC,gCAAgC,IAAI,8DAAC,EAAE,6FAAC,mCAAmC,8DAAC,EAAE,6FAAC,qCAAqC,8DAAC,EAAE,6FAAC,4CAA4C,UAA+B;;;;;;;;;;;;;ACJrvF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACkhB,YAAY,sBAAsB,aAAa,+BAA+B,oGAAC,EAAE,iBAAiB,EAAE,UAAU,qEAAqE,yBAAyB,MAAM,kJAAkJ,sBAAsB,MAAM,QAAQ,MAAM,gCAAgC,sDAAC,oEAAoE,QAAQ,GAAG,MAAM,eAAe,GAAG,gCAAgC,sDAAC,kEAAkE,eAAe,GAAG,8CAA8C,iCAAiC,MAAM,kCAAkC,GAAG,wBAAwB,sDAAC,mFAAmF,0BAA0B,EAAE,sCAAsC,mCAAmC,OAAO,8DAAC,EAAE,6FAAC,gDAAgD,8DAAC,EAAE,6FAAC,EAAE,YAAY,0CAA0C,8DAAC,EAAE,6FAAC,gCAAgC,8DAAC,EAAE,6FAAC,CAAC,uGAAC,sCAAsC,8DAAC,EAAE,6FAAC,2CAAkF","file":"layers-WMSLayerView2D-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import o from\"../../../geometry/Extent.js\";import{BitmapContainer as n}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as p}from\"./LayerView2D.js\";import m from\"./support/ExportStrategy.js\";import h from\"../../layers/LayerView.js\";import{RefreshableLayerView as c}from\"../../layers/RefreshableLayerView.js\";import{WMSLayerView as d}from\"../../layers/WMSLayerView.js\";const l=r.getLogger(\"esri.views.2d.layers.WMSLayerView2D\");let y=class extends(d(c(p(h)))){initialize(){const{layer:e,view:r}=this;e.supportsSpatialReference(r.spatialReference)||this.addResolvingPromise(Promise.reject(new t(\"layerview:spatial-reference-incompatible\",\"The spatial references supported by this WMS layer are incompatible with the spatial reference of the view\",{layer:e})))}update(e){this.strategy.update(e).catch((e=>{i(e)||l.error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:r}=e;this._bitmapContainer=new n,this.container.addChild(this._bitmapContainer),this.strategy=new m({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:r,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\")}detach(){this.handles.remove(\"exportImageVersion\"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,r=this._bitmapContainer,{x:i,y:s}=e,{spatialReference:a}=t;let n=null,p=0,m=0;if(r.children.some((e=>{const{width:t,height:r,resolution:h,x:c,y:d}=e,l=c+h*t,y=d-h*r;return i>=c&&i<=l&&s<=d&&s>=y&&(n=new o({xmin:c,ymin:y,xmax:l,ymax:d,spatialReference:a}),p=t,m=r,!0)})),!n)return null;const h=n.width/p,c=Math.round((i-n.xmin)/h),d=Math.round((n.ymax-s)/h);return{extent:n,width:p,height:m,x:c,y:d}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,...i})}};e([s()],y.prototype,\"strategy\",void 0),e([s()],y.prototype,\"updating\",void 0),y=e([a(\"esri.views.2d.layers.WMSLayerView2D\")],y);const u=y;export{u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as s}from\"../../layers/support/commonProperties.js\";import{ExportWMSImageParameters as p}from\"../../layers/support/ExportWMSImageParameters.js\";const a=a=>{let i=class extends a{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}fetchPopupFeatures(e){const{layer:t}=this;if(!e)return Promise.reject(new r(\"wmslayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:t}));const{popupEnabled:o}=t;if(!o)return Promise.reject(new r(\"wmslayerview:fetchPopupFeatures\",\"popupEnabled should be true\",{popupEnabled:o}));const s=this.createFetchPopupFeaturesQuery(e);if(!s)return Promise.resolve([]);const{extent:p,width:a,height:i,x:m,y:n}=s;if(!(p&&a&&i))throw new r(\"wmslayerview:fetchPopupFeatures\",\"WMSLayer does not support fetching features.\",{extent:p,width:a,height:i});const u=t.fetchFeatureInfo(p,a,i,m,n);return Promise.resolve(u?[u]:[])}};return e([t()],i.prototype,\"exportImageParameters\",void 0),e([t({readOnly:!0})],i.prototype,\"exportImageVersion\",null),e([t()],i.prototype,\"layer\",void 0),e([t(s)],i.prototype,\"timeExtent\",void 0),i=e([o(\"esri.layers.mixins.WMSLayerView\")],i),i};export{a as WMSLayerView,a as default};\n"],"sourceRoot":"webpack:///"}